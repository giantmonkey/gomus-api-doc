<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>go~mus Reseller API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="reseller_api" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://gomus.de'>go~mus</a></li>
            <li><a href='https://github.com/tripit/slate'>Documentation powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="preparation">Preparation</h1>

<p>Before you can use the go~mus reseller API to create valid orders, you will have to register a user account with an API key. Please talk to your contact person in order to get access.</p>

<aside class="success">
Remember â€” a happy api user is an authenticated api user!
</aside>

<p>See <a href="public_api.html">detailed documentation on Public API</a> for information on how to request the basic data for events, tours and tickets.</p>

<h1 id="orders">Orders</h1>

<p>An order is the final result of a checkout process, e.g. like in normal online shops. Every ticket sale or event booking is wrapped into items in a cart and sent to the server for validation.</p>

<p>The server-side will do a final validation and return whether our order was successful.
In a success case a JSON with the valid order will be returned.</p>

<p>Note: the payment handling, including access to third party tools, might differ depending on your API plan.</p>

<h2 id="list-of-exisiting-orders">List of exisiting orders</h2>

<p>Existing orders in your account can be accessed at the orders index endpoint:</p>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders</code></p>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/orders"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3944805</span><span class="p">,</span><span class="w">
            </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aniq532VCewghH2mUtEnng"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"is_valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total_price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w">
            </span><span class="nt">"comment"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"rating"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"invoice"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-03-28T22:17:46+02:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"per_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="available-parameters">Available parameters:</h3>

<ul>
<li>start_at, order date (<code class="prettyprint">YYYY-MM-DD</code>), defaults to today</li>
<li>end_at, order date (<code class="prettyprint">YYYY-MM-DD</code>), defaults to today</li>
<li>per_page, defaults to system default (<code class="prettyprint">25</code>)</li>
<li>page, defaults to <code class="prettyprint">1</code></li>
</ul>

<h3 id="response">Response</h3>

<p>The JSON response contains a list of existing orders as an array and a meta block.</p>

<ul>
<li>id (integer), the unique database id of the order</li>
<li>token (string), a unique token of the order, see more at the documents section</li>
<li>is_valid (boolean), whether the order is valid or not</li>
<li>total_price_cents (integer), the total amount of the order in EUR cents (mind the discounts for each item)</li>
<li>comment (text), a comment, defined on creation</li>
<li>reference (text), reference field, can be used for advertising</li>
<li>rating (integer), a simple amazon style rating value</li>
<li>invoice (boolean), whether an invoice is available or not</li>
<li>created_at (date), timestamp on creation</li>
<li>items (array), list of order items, see order items section</li>
</ul>

<h2 id="details-of-a-single-order">Details of a single order</h2>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:id</code></p>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/orders/1"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like a single element of the orders array from the order list but with two additional keys:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">...</span><span class="w">

        </span><span class="nt">"payment_status"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
        </span><span class="nt">"billing_address_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">378542</span><span class="p">,</span><span class="w">

        </span><span class="err">...</span><span class="w">
    </span><span class="err">}</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="response">Response</h3>

<ul>
<li>payment_status (integer), if using a payment provider, the status is set by the provider. Usualy not in use for resellers.</li>
<li>billing_address_id (integer), reference to an address dataset. Not in use right now, but in future versions of th API resellers might be able to use several adresses for one account.</li>
</ul>

<h2 id="find-single-order-by-barcode">Find single order by barcode</h2>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/barcode/:barcode</code></p>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/orders/barcode/704323341"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured just like the details of a single order.</p>
</blockquote>

<h3 id="barcodes">Barcodes</h3>

<p>The barcode may belong to any item that is contained in the order.</p>

<h2 id="documents">Documents</h2>

<p>Each order item has a pdf document containing the relevant information according to the item type. Ticket item pdfs contain the tickets: one per page. Event and tour items have a pdf containing the booking confirmation.</p>

<p>These are available to download if the order <code class="prettyprint">is_valid</code> and if there is a <code class="prettyprint">token</code> present.</p>

<p>Some orders may have an invoice available (indicated by the <code class="prettyprint">invoice</code> attribute in the order).</p>

<p>Some orders may have passbooks for tickets available (indicated by the <code class="prettyprint">passbooks</code> attribute in the ticket sale in order).</p>

<p>Due to the token confirmation, authentication via header request is not needed for the document requests.</p>

<h3 id="tickets">Tickets</h3>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:order_id/tickets/:ticket_id.pdf?token=:token</code></p>

<ul>
<li>ticket_id means the uniq ticket sale id (order -&gt; order item -&gt; ticket sale)</li>
</ul>

<h3 id="passbooks">Passbooks</h3>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:order_id/tickets/:ticket_id/passbooks/:barcode.pkpass?token=:token</code></p>

<ul>
<li>ticket_id means the uniq ticket sale id (order -&gt; order item -&gt; ticket sale)</li>
<li>barcode means the uniq barcode for each item within a ticket sale (order -&gt; order item -&gt; ticket sale -&gt; barcodes)</li>
</ul>

<h3 id="events">Events</h3>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:order_id/events/:event_id.pdf?token=:token</code></p>

<ul>
<li>event_id means the uniq event booking id (order -&gt; order item -&gt; event booking)</li>
</ul>

<h3 id="tours">Tours</h3>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:order_id/tours/:tour_id.pdf?token=:token</code></p>

<ul>
<li>tour_id means the uniq tour booking id (order -&gt; order item -&gt; tour booking)</li>
</ul>

<h3 id="invoice">Invoice</h3>

<p><code class="prettyprint">GET https://demo.gomus.de/api/v4/orders/:order_id/invoice.pdf?token=:token</code></p>

<h1 id="order-items">Order Items</h1>

<p>In both list and detailed view the response contains an array of <code class="prettyprint">items</code>. Each item can be one of Ticket, Event or Tour with a slightly different structure.</p>

<p>Each item contains generic attributes like</p>

<ul>
<li>id (integer), the uniq database id of the order item</li>
<li>type (string), the type of item, can be one of &ldquo;Ticket&rdquo;, &ldquo;Event&rdquo;, or &ldquo;Tour&rdquo;</li>
<li>price_cents (integer), price of the item in EUR cents</li>
<li>vat_pct (float), the item tax rate</li>
<li>tax_included (boolean), whether the tax (if any) is included in price_cents or not</li>
</ul>

<p>and the specific attributes block, which is different for every type.</p>

<h2 id="ticket-item">Ticket Item</h2>

<blockquote>
<p>a single ticket type item in the order items array looks like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">52397</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ticket"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">1400</span><span class="p">,</span><span class="w">
  </span><span class="nt">"vat_pct"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"tax_included"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42102</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"El Siglo de Oro mit GemÃ¤ldegalerie regulÃ¤r"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ticket_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">247</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ticket_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"time_slot"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-14T15:00:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GemÃ¤ldegalerie"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Berlin"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deutschland"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MatthÃ¤ikirchplatz"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10785"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.5082</span><span class="p">,</span><span class="w">
      </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">13.3673</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"barcodes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">97633</span><span class="p">,</span><span class="w">
        </span><span class="nt">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4034210297633-5"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ean"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"after_sale_information"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="attributes">Attributes</h3>

<p>Each ticket type item contains attributes like</p>

<ul>
<li>id (integer), the uniq database id of this ticket sale</li>
<li>title (string), the title of the parent ticket</li>
<li>ticket_id (integer), the database parents ticket id</li>
<li>quantity (integer)</li>
<li>ticket_type (string), the type of ticket</li>
<li>start_time (iso8601), the start time of the ticket</li>
<li>after_sale_information (text), text containing information for the customer after sale</li>
</ul>

<p>plus two attribute blocks for the location and the barcodes.</p>

<h3 id="location">Location</h3>

<p>The location is provided as street adress and geo-coordinates. Mind that most museums have no house number.</p>

<h3 id="barcodes">Barcodes</h3>

<p>Each ticket sale will a have one barcode per quantity. Each barcode can be validated and devalued separately.</p>

<p>The barcodes are supposed to be printed on paper. One barcode per sheet.</p>

<h4 id="note-for-tickets-to-attractions-of-the-quot-staatlichen-museen-zu-berlin-quot">Note for tickets to attractions of the &ldquo;Staatlichen Museen zu Berlin&rdquo;:</h4>

<p>The barcodes need to be encoded as <a href="https://en.wikipedia.org/wiki/Code_39">CODE 39</a>, so that they can be scanned.
Please pay special attention to the required quiet zone and minimal size requirements. You may find an example printout <a href="images/ticket-pdf-example.pdf">here</a>.</p>

<h2 id="event-item">Event Item</h2>

<blockquote>
<p>a single event type item in the order items array looks like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">52399</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w">
  </span><span class="nt">"vat_pct"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"tax_included"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6127</span><span class="p">,</span><span class="w">
    </span><span class="nt">"date_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">22977</span><span class="p">,</span><span class="w">
    </span><span class="nt">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">101174</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-09T14:30:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"El Siglo de Oro"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GemÃ¤ldegalerie"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Berlin"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deutschland"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MatthÃ¤ikirchplatz"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10785"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.5082</span><span class="p">,</span><span class="w">
      </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">13.3673</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="attributes">Attributes</h3>

<p>Each event type item contains attributes like</p>

<ul>
<li>id (integer), the uniq database id of this event date booking</li>
<li>title (string), the title of the event</li>
<li>event_id (integer), the database id of the event</li>
<li>date_id (integer), the database id of the specific date for this event</li>
<li>start_time (iso8601), the date&rsquo;s timestamp</li>
<li>quantity (integer), if the event has a simple price configuration, this represents the seat count</li>
</ul>

<p>plus attribute blocks for the location and quantities, if price configuration is complex (scale prices)</p>

<h3 id="location">Location</h3>

<p>The location is provided as street adress and geo-coordinates. Mind that most museums have no house number.</p>

<h2 id="tour-item">Tour Item</h2>

<blockquote>
<p>a single tour type item in the order items array looks like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">56398</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tour"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w">
  </span><span class="nt">"vat_pct"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"tax_included"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">27079</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"El Siglo de Oro | GruppenfÃ¼hrung"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"tour_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">101173</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-24T12:00:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"participants"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deutsch"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"age_group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Erwachsene"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"prices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Entgelt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gruppenpreis"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"total_price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GemÃ¤ldegalerie"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Berlin"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deutschland"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MatthÃ¤ikirchplatz"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10785"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.5082</span><span class="p">,</span><span class="w">
      </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">13.3673</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="attributes">Attributes</h3>

<p>Each event type item contains attributes like</p>

<ul>
<li>id (integer), the uniq database id this event booking</li>
<li>title (string), the title of the event</li>
<li>tour_id (integer), the database id of the tour</li>
<li>start_time (iso8601), the timestamp for the tour</li>
<li>participants (integer)</li>
<li>language (string)</li>
<li>age group_(string)</li>
</ul>

<p>plus attribute blocks for the location and prices</p>

<h3 id="location">Location</h3>

<p>The location is provided as street adress and geo-coordinates. Mind that most museums have no house number.</p>

<h3 id="prices">Prices</h3>

<p>The price of a tour booking depends on several pricing factors like surcharges and other fees. The <code class="prettyprint">prices</code> array holds all single price items which are summed up to the order items <code class="prettyprint">price_cents</code> total.</p>

<h3 id="equipments">Equipments</h3>

<p>The tour item may contain an additional block for booking equipment at the <strong>same</strong> start time:</p>
<pre class="highlight json"><code><span class="w">    </span><span class="err">equipment:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="err">id:</span><span class="w"> </span><span class="err">1,</span><span class="w">
        </span><span class="err">quantity:</span><span class="w"> </span><span class="err">3</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span></code></pre>

<h1 id="creating-an-order">Creating an Order</h1>

<p>An order is created by a POST request to the orders endpoint:</p>

<p><code class="prettyprint">POST https://demo.gomus.de/api/v4/orders</code></p>

<p>There can be only one order per request. One order can contain several items (tickets, tour bookings and event bookings)</p>

<p>A final validation check will be made on the server. Either all order items are bought or none.
In case of errors you will get error messages back as a response.</p>

<blockquote>
<p>Write definition of order into /tmp/order.json before executing shell command.</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/orders"</span>
    -XPOST --data <span class="s2">"@/tmp/order.json"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command assumes the order.json JSON is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please send fast!"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bought you by the awesome tourist gmbh!"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1400</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="required-attributes">Required attributes</h3>

<ul>
<li>comment (text), your comment, not readable on confirmation documents</li>
<li>reference (text), your reference, readable on confirmation documents</li>
<li>items (array), list of item configurations</li>
<li>total (integer), the sum of all item prices. This ensures that the server and the client calculate the same price.</li>
</ul>

<h2 id="items">Items</h2>

<p>A valid order needs at least one valid item. One item can either be a ticket sale, an event booking or a tour booking.</p>

<p>An item has two major attributes:</p>

<ul>
<li>type (text), one of &ldquo;Ticket&rdquo;, &ldquo;Event&rdquo;, or &ldquo;Tour&rdquo;</li>
<li>attributes (hash), a set of attributes specific to the item type</li>
</ul>

<h3 id="ticket">Ticket</h3>

<blockquote>
<p>a single item holding a ticket sale is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ticket"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">247</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-07T13:00:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"reservations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"8CE0mEgjyAvQB1IbPJ4iyg"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"attendees"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Capt'n"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"surname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hook"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Peter"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"surname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pan"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A ticket item has a fairly simple structure:</p>

<ul>
<li>id (integer), the tickets id, see ticket section in public api</li>
<li>quantity (integer), a count &gt; 0</li>
<li>time (iso8601), the entry timestamp</li>
<li>reservations (array of tokens), if any (see Tickets -&gt; Reservations for more info)</li>
<li>attendees (array of objects), needs to be set on purchase when ticket&rsquo;s attendees are required. Attendees require a name and surname. Number of attendees needs to match the ticket sales quantity.</li>
<li>sub_ticket_times (hash of sub ticket times), only needed if the ticket has sub tickets. See the <a href="#example-pergamon-panorama-smb">Pergamon + Panorama example</a> for more information.</li>
</ul>

<h3 id="event">Event</h3>

<blockquote>
<p>a single item holding an event booking is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28227</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>or with several price options:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28227</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantities"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"4"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>or with specific seating options:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28227</span><span class="p">,</span><span class="w">
    </span><span class="nt">"seats"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"seat_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scale_price_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"seat_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scale_price_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>An event item has a similar structure:</p>

<ul>
<li>id (integer), the events date id, see event section in public api</li>
</ul>

<p>If the event only has one price, the quantity key is used.</p>

<ul>
<li>quantity (integer), a count &gt; 0</li>
</ul>

<p>However, if the event has scale pricing, then the quantities key is used instead:</p>

<ul>
<li>quantities (object), the scale price id as the key, and the quantity as the value.</li>
</ul>

<p>If the event contains seatings, the strucuture has to contain info about the specific seats:</p>

<ul>
<li>seat_id (integer), id of the specific seat</li>
<li>scale_price_id (integer), id of the scale price</li>
</ul>

<h3 id="tour">Tour</h3>

<blockquote>
<p>a single item holding a tour booking is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tour"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28227</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-07T13:00:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"age_group_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"surcharges"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"4"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>or with several price options:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tour"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28227</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-07T13:00:00+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"age_group_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantities"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"4"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"surcharges"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"4"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A tour item extends the structure of events:</p>

<ul>
<li>id (integer), the tour id, see tour section in public api</li>
<li>surcharges (object), the surcharge id as the key, and the quantity as the value</li>
<li>start_time (iso8601), the entry timestamp</li>
<li>language_id (reference)</li>
<li>age_group_id (reference)</li>
</ul>

<p>If the tour only has one price, the quantity key is used.</p>

<ul>
<li>quantity (integer), a count &gt; 0</li>
</ul>

<p>However, if the tour has scale pricing, then the quantities key is used instead:</p>

<ul>
<li>quantities (object), the scale price id as the key, and the quantity as the value</li>
</ul>

<p>Surcharge configuration must be provided if tour is configured with surcharges (see tour section in the public api). The surcharge configuration is validated on server side.</p>

<p>Note: the quantity or sum of quantities represents the number of participants (people in group)</p>

<h1 id="combined-tickets">Combined Tickets</h1>

<p>In special cases a museum may offer a combined ticket that includes multiple sub tickets. The sub tickets may have individual separate time slots.</p>

<p>A public example are the Pergamon + Panorama Tickets by the Staatliche Museen zu Berlin (SMB).</p>

<h2 id="important-restrictions">Important restrictions</h2>

<ul>
<li>combined tickets cannot be reserved</li>
<li>sub tickets cannot be bought directly, only main ticket can be bought</li>
</ul>

<h2 id="example-pergamon-panorama-smb">Example Pergamon + Panorama SMB</h2>

<p>The following example uses the public API of smb to show a step by step guide on how to order combined tickets. The following data was taken from the live instance on 1st November 2018. The data may look different at a later date.</p>

<h3 id="1-query-ticket-list-as-usual">1. Query ticket list as usual</h3>

<blockquote>
<p>One of the available tickets will be the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">514</span><span class="p">,</span><span class="w"> </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pergamonmuseum + Das Panorama | regulÃ¤r"</span><span class="p">,</span><span class="w"> </span><span class="nt">"ticket_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"time_slot"</span><span class="p">,</span><span class="w"> </span><span class="nt">"bookable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets?valid_at=2018-11-20</code></p>

<p>Get a list of tickets. One of the tickets will be <code class="prettyprint">Pergamonmuseum + Das Panorama | regulÃ¤r</code>.</p>

<h3 id="2-reading-details-of-main-ticket">2. Reading details of main ticket</h3>

<blockquote>
<p>Ticket detail response of a ticket with sub tickets:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">1900</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quota_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">98</span><span class="p">],</span><span class="w">
    </span><span class="nt">"sub_ticket_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">515</span><span class="p">,</span><span class="w"> </span><span class="mi">516</span><span class="p">],</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets/514</code></p>

<p>In the ticket details we can see that this ticket has an extra key <code class="prettyprint">sub_ticket_ids</code> compared to the <a href="public_api.html#details-of-single-ticket">standard</a> ticket keys.
This field contains 2 ID&rsquo;s of two sub tickets.
The sub tickets will refer to the individual entry locations and will later have two individual time slots.</p>

<p>The main ticket itself contains the price, 19 â‚¬ in our example.</p>

<p>Also take note that the main ticket also has a quota, in order to buy the ticket, all ticket quotas need be available, main and sub tickets.</p>

<h3 id="3-reading-details-of-sub-tickets">3. Reading details of sub tickets</h3>

<blockquote>
<p>The ticket detail response of the sub tickets:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">515</span><span class="p">,</span><span class="w"> </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subticket Pergamonmuseum"</span><span class="p">,</span><span class="w"> </span><span class="nt">"is_sub_ticket"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"quota_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">37</span><span class="p">],</span><span class="w"> </span><span class="nt">"ticket_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"time_slot"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="w">

</span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">516</span><span class="p">,</span><span class="w"> </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subticket Das Panorama"</span><span class="p">,</span><span class="w"> </span><span class="nt">"is_sub_ticket"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"quota_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">99</span><span class="p">],</span><span class="w"> </span><span class="nt">"ticket_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"time_slot"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets/515</code>
<code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets/516</code></p>

<p>Both sub tickets have no price. The price is handled in the main ticket.</p>

<p>But both tickets reference a quota. Both quotas need to be available.</p>

<h3 id="4-reading-capacities">4. Reading capacities</h3>

<blockquote>
<p>An example of a capacity response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"2018-11-20T10:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T10:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T11:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T11:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T12:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T12:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T13:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T13:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T14:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T14:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T15:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T15:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T16:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T16:30:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
  </span><span class="nt">"2018-11-20T17:00:00+01:00"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets/515/capacity?date=2018-11-20</code>
<code class="prettyprint">GET https://smb.gomus.de/api/v4/tickets/516/capacity?date=2018-11-20</code></p>

<p>We assume that you already checked the availability of the main ticket and will only look at the sub tickets in the following explanation.</p>

<p>You will need to select one time slot for the first ticket and another time slot for the second ticket.</p>

<p>For example we could select:</p>

<ul>
<li>Ticket 515: 2018-11-20T12:30:00+01:00</li>
<li>Ticket 516: 2018-11-20T14:00:00+01:00</li>
</ul>

<p><strong><em>Attention: In SMB the time slots have to be 90 minutes apart.</em></strong></p>

<p>You are free to decide which ticket should have the first time slot. It might be good to let the customer decide where he wants to go first.</p>

<p>In our example the customer will go to &ldquo;Pergamonmuseum&rdquo; first and then to &ldquo;Das Panorama&rdquo;.</p>

<h3 id="5-creating-the-order">5. Creating the order</h3>

<blockquote>
<p>Example ticket order item with sub tickets:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ticket"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">514</span><span class="p">,</span><span class="w">
    </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-11-20T12:30:00+01:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"sub_ticket_times"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"515"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-11-20T12:30:00+01:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"516"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-11-20T14:00:00+01:00"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>See the sections above for reference on how to create an order.</p>

<p>Here we will detail how the ticket attributes are structured inside an order request when buying a combined ticket.</p>

<p>The ticket item is exactly the same as a <a href="#items">normal ticket item</a>, with the addition of the <code class="prettyprint">sub_ticket_times</code> hash.</p>

<p>Take note that we</p>

<ol>
<li>send an attributes hash that references the main ticket.</li>
<li>we need to set a time for the main ticket. It is best practice to set this to the earliest time slot that we use in sub tickets.</li>
<li>we set the times for the sub tickets in the field <code class="prettyprint">sub_ticket_times</code>. These are the entry times that we selected in step 4.</li>
</ol>

<p>You can also set the <code class="prettyprint">attendees</code> fields in the attributes hash as normal. We omitted them here for brevity. Please not that reservations are not currently possible.</p>

<h3 id="6-handling-of-barcodes-in-the-order-result">6. Handling of barcodes in the order result</h3>

<blockquote>
<p>Example of a barcode returned from the order detail response:</p>
</blockquote>
<pre class="highlight json"><code><span class="s2">"barcodes"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">97633</span><span class="p">,</span><span class="w">
        </span><span class="nt">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4034210297633-5"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ean"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="err">,</span><span class="w">
</span></code></pre>

<p>After you have created the order you will get back a normal order response as was detailed in the sections above.</p>

<p>Of special notice are two things, first you will get a single barcode for the main ticket. This ticket barcode can be used in all entry locations.</p>

<p>And second, it is best practice to print the individual sub ticket times on the ticket PDF that customers will receive.</p>

<p>The sub ticket times will be checked on entry and customer confusion may result if these are not clearly communicated.</p>

<h2 id="looking-at-an-online-example-of-combined-tickets">Looking at an online example of combined tickets</h2>

<p>You can look at the official online shop implementation of Staatliche Museen zu Berlin in order to better understand how to structure queries and how to implement a UI for time slot selection in combined tickets.</p>

<p>Make sure to select 2018-11-20 or a later date when looking for combined Pergamon + Panorama tickets.</p>

<p>https://shop.smb.museum/#/tickets/list?date=2018-11-20</p>

          <h1 id="ticket-reservations">Ticket Reservations</h1>

<p>Tickets can be (short term) reserved for 5 minutes each. The reservation can be updated (and refreshed) for a max of 60 minutes 
reservation time. Note that the ticket itself must be bookable for the time of reservation.</p>

<h3 id="creating-a-reservation">Creating a reservation</h3>

<p>A ticket can be reserved like this:</p>

<p><code class="prettyprint">POST https://demo.gomus.de/api/v4/tickets/reservations</code></p>

<blockquote>
<p>Write definition of order into /tmp/reservations.json before executing shell command.</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/tickets/reservations"</span>
    -XPOST --data <span class="s2">"@/tmp/reservations.json"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command assumes the reservations.json JSON is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nt">"reservation"</span><span class="p">:</span><span class="w"> 
          </span><span class="p">{</span><span class="w">
              </span><span class="nt">"ticket_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">247</span><span class="p">,</span><span class="w">
              </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
              </span><span class="nt">"start_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-25T16:00:00+02:00"</span><span class="w">
         </span><span class="p">}</span><span class="w">

   </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The response will contain the reservation object or an error.</p>

<h3 id="response">Response</h3>

<p>The response is a data block, which contains the validity information like this:</p>
<pre class="highlight json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"reservation"</span><span class="p">:</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"token"</span><span class="p">:</span><span class="s2">"XBqvPGe09EyXPi4iDC1Mgg"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"quantity"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
            </span><span class="nt">"ticket_id"</span><span class="p">:</span><span class="mi">247</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_at"</span><span class="p">:</span><span class="s2">"2016-09-25T16:00:00+02:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"valid_until"</span><span class="p">:</span><span class="s2">"2016-09-02T19:11:20+02:00"</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="updating-and-refreshing-a-reservation">Updating and refreshing a reservation</h3>

<p>A ticket reservation can be updated and refreshed like this:</p>

<p><code class="prettyprint">PUT https://demo.gomus.de/api/v4/tickets/reservations/:token</code></p>

<blockquote>
<p>Write definition of order into /tmp/reservation_update.json before executing shell command.</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/tickets/reservations/:token"</span>
    -XPUT --data <span class="s2">"@/tmp/reservations_update.json"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<blockquote>
<p>The above command assumes the reservation_update.json JSON is structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">

    </span><span class="nt">"reservation"</span><span class="p">:</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
        </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The response will contain the reservation object or an error.</p>

<p>Note: you can only update the quantity, the validity will automaticaly refresh on each update.</p>

<h3 id="deleting-a-reservation">Deleting a reservation</h3>

<p>A ticket reservation can be deleted. It is advised that you do so if the reservation is no longer needed.</p>

<p><code class="prettyprint">DELETE https://demo.gomus.de/api/v4/tickets/reservations/:token</code></p>

<blockquote>
<p>Write definition of order into /tmp/reservation_update.json before executing shell command.</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://demo.gomus.de/api/v4/tickets/reservations/:token"</span>
    -XDELETE
    -H <span class="s2">"Content-Type: application/json"</span>
    -H <span class="s2">"Authorization: Bearer meowmeowmeow"</span>
</code></pre>

<p>The response will have no content.</p>

          <h1 id="errors">Errors</h1>

<p>The go~mus API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The API endpoint requested is for administrators only</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified record could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access an API endpoint with an invalid method</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity &ndash; The data you have passed cannot be processed</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re requesting too much! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
